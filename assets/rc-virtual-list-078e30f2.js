import{a as $,h as ge,d as q,k as Oe,l as ze,f as pe,e as me,c as _,_ as Re,b as We}from"./@babel-9169ff57.js";import{r as o}from"./react-5cc2acaa.js";import{c as B}from"./classnames-5c20d0be.js";import{R as Ke}from"./rc-resize-observer-2e6aca21.js";import{o as H,F as je,b as ne}from"./rc-util-1f458f21.js";var Se=o.forwardRef(function(r,v){var u=r.height,e=r.offset,c=r.children,i=r.prefixCls,l=r.onInnerResize,t=r.innerProps,n={},a={display:"flex",flexDirection:"column"};return e!==void 0&&(n={height:u,position:"relative",overflow:"hidden"},a=$($({},a),{},{transform:"translateY(".concat(e,"px)"),position:"absolute",left:0,right:0,top:0})),o.createElement("div",{style:n},o.createElement(Ke,{onResize:function(s){var d=s.offsetHeight;d&&l&&l()}},o.createElement("div",ge({style:a,className:B(q({},"".concat(i,"-holder-inner"),i)),ref:v},t),c)))});Se.displayName="Filler";var Ve=20;function de(r){return"touches"in r?r.touches[0].pageY:r.pageY}var Ae=function(r){Oe(u,r);var v=ze(u);function u(){var e;pe(this,u);for(var c=arguments.length,i=new Array(c),l=0;l<c;l++)i[l]=arguments[l];return e=v.call.apply(v,[this].concat(i)),e.moveRaf=null,e.scrollbarRef=o.createRef(),e.thumbRef=o.createRef(),e.visibleTimeout=null,e.state={dragging:!1,pageY:null,startTop:null,visible:!1},e.delayHidden=function(){clearTimeout(e.visibleTimeout),e.setState({visible:!0}),e.visibleTimeout=setTimeout(function(){e.setState({visible:!1})},2e3)},e.onScrollbarTouchStart=function(t){t.preventDefault()},e.onContainerMouseDown=function(t){t.stopPropagation(),t.preventDefault()},e.patchEvents=function(){window.addEventListener("mousemove",e.onMouseMove),window.addEventListener("mouseup",e.onMouseUp),e.thumbRef.current.addEventListener("touchmove",e.onMouseMove),e.thumbRef.current.addEventListener("touchend",e.onMouseUp)},e.removeEvents=function(){var t;window.removeEventListener("mousemove",e.onMouseMove),window.removeEventListener("mouseup",e.onMouseUp),(t=e.scrollbarRef.current)===null||t===void 0||t.removeEventListener("touchstart",e.onScrollbarTouchStart),e.thumbRef.current&&(e.thumbRef.current.removeEventListener("touchstart",e.onMouseDown),e.thumbRef.current.removeEventListener("touchmove",e.onMouseMove),e.thumbRef.current.removeEventListener("touchend",e.onMouseUp)),H.cancel(e.moveRaf)},e.onMouseDown=function(t){var n=e.props.onStartMove;e.setState({dragging:!0,pageY:de(t),startTop:e.getTop()}),n(),e.patchEvents(),t.stopPropagation(),t.preventDefault()},e.onMouseMove=function(t){var n=e.state,a=n.dragging,f=n.pageY,s=n.startTop,d=e.props.onScroll;if(H.cancel(e.moveRaf),a){var g=de(t)-f,m=s+g,S=e.getEnableScrollRange(),M=e.getEnableHeightRange(),D=M?m/M:0,L=Math.ceil(D*S);e.moveRaf=H(function(){d(L)})}},e.onMouseUp=function(){var t=e.props.onStopMove;e.setState({dragging:!1}),t(),e.removeEvents()},e.getSpinHeight=function(){var t=e.props,n=t.height,a=t.count,f=n/a*10;return f=Math.max(f,Ve),f=Math.min(f,n/2),Math.floor(f)},e.getEnableScrollRange=function(){var t=e.props,n=t.scrollHeight,a=t.height;return n-a||0},e.getEnableHeightRange=function(){var t=e.props.height,n=e.getSpinHeight();return t-n||0},e.getTop=function(){var t=e.props.scrollTop,n=e.getEnableScrollRange(),a=e.getEnableHeightRange();if(t===0||n===0)return 0;var f=t/n;return f*a},e.showScroll=function(){var t=e.props,n=t.height,a=t.scrollHeight;return a>n},e}return me(u,[{key:"componentDidMount",value:function(){this.scrollbarRef.current.addEventListener("touchstart",this.onScrollbarTouchStart),this.thumbRef.current.addEventListener("touchstart",this.onMouseDown)}},{key:"componentDidUpdate",value:function(c){c.scrollTop!==this.props.scrollTop&&this.delayHidden()}},{key:"componentWillUnmount",value:function(){this.removeEvents(),clearTimeout(this.visibleTimeout)}},{key:"render",value:function(){var c=this.state,i=c.dragging,l=c.visible,t=this.props.prefixCls,n=this.getSpinHeight(),a=this.getTop(),f=this.showScroll(),s=f&&l;return o.createElement("div",{ref:this.scrollbarRef,className:B("".concat(t,"-scrollbar"),q({},"".concat(t,"-scrollbar-show"),f)),style:{width:8,top:0,bottom:0,right:0,position:"absolute",display:s?null:"none"},onMouseDown:this.onContainerMouseDown,onMouseMove:this.delayHidden},o.createElement("div",{ref:this.thumbRef,className:B("".concat(t,"-scrollbar-thumb"),q({},"".concat(t,"-scrollbar-thumb-moving"),i)),style:{width:"100%",height:n,top:a,left:0,position:"absolute",background:"rgba(0, 0, 0, 0.5)",borderRadius:99,cursor:"pointer",userSelect:"none"},onMouseDown:this.onMouseDown}))}}]),u}(o.Component);function Ge(r){var v=r.children,u=r.setRef,e=o.useCallback(function(c){u(c)},[]);return o.cloneElement(v,{ref:e})}function Ze(r,v,u,e,c,i){var l=i.getKey;return r.slice(v,u+1).map(function(t,n){var a=v+n,f=c(t,a,{}),s=l(t);return o.createElement(Ge,{key:s,setRef:function(g){return e(t,g)}},f)})}var qe=function(){function r(){pe(this,r),this.maps=void 0,this.maps=Object.create(null)}return me(r,[{key:"set",value:function(u,e){this.maps[u]=e}},{key:"get",value:function(u){return this.maps[u]}}]),r}();function Be(r,v,u){var e=o.useState(0),c=_(e,2),i=c[0],l=c[1],t=o.useRef(new Map),n=o.useRef(new qe),a=o.useRef();function f(){H.cancel(a.current)}function s(){f(),a.current=H(function(){t.current.forEach(function(g,m){if(g&&g.offsetParent){var S=je(g),M=S.offsetHeight;n.current.get(m)!==M&&n.current.set(m,S.offsetHeight)}}),l(function(g){return g+1})})}function d(g,m){var S=r(g),M=t.current.get(S);m?(t.current.set(S,m),s()):t.current.delete(S),!M!=!m&&(m?v==null||v(g):u==null||u(g))}return o.useEffect(function(){return f},[]),[d,s,n.current,i]}function Je(r,v,u,e,c,i,l,t){var n=o.useRef();return function(a){if(a==null){t();return}if(H.cancel(n.current),typeof a=="number")l(a);else if(a&&Re(a)==="object"){var f,s=a.align;"index"in a?f=a.index:f=v.findIndex(function(S){return c(S)===a.key});var d=a.offset,g=d===void 0?0:d,m=function S(M,D){if(!(M<0||!r.current)){var L=r.current.clientHeight,U=!1,b=D;if(L){for(var Y=D||s,O=0,C=0,E=0,J=Math.min(v.length,f),I=0;I<=J;I+=1){var z=c(v[I]);C=O;var k=u.get(z);E=C+(k===void 0?e:k),O=E,I===f&&k===void 0&&(U=!0)}var w=null;switch(Y){case"top":w=C-g;break;case"bottom":w=E-L+g;break;default:{var W=r.current.scrollTop,R=W+L;C<W?b="top":E>R&&(b="bottom")}}w!==null&&w!==r.current.scrollTop&&l(w)}n.current=H(function(){U&&i(),S(M-1,b)},2)}};m(3)}}}function Qe(r,v,u){var e=r.length,c=v.length,i,l;if(e===0&&c===0)return null;e<c?(i=r,l=v):(i=v,l=r);var t={__EMPTY_ITEM__:!0};function n(m){return m!==void 0?u(m):t}for(var a=null,f=Math.abs(e-c)!==1,s=0;s<l.length;s+=1){var d=n(i[s]),g=n(l[s]);if(d!==g){a=s,f=f||d!==n(l[s+1]);break}}return a===null?null:{index:a,multiple:f}}function Xe(r,v,u){var e=o.useState(r),c=_(e,2),i=c[0],l=c[1],t=o.useState(null),n=_(t,2),a=n[0],f=n[1];return o.useEffect(function(){var s=Qe(i||[],r||[],v);(s==null?void 0:s.index)!==void 0&&(u==null||u(s.index),f(r[s.index])),l(r)},[r]),[a]}var et=(typeof navigator>"u"?"undefined":Re(navigator))==="object"&&/Firefox/i.test(navigator.userAgent);const Me=function(r,v){var u=o.useRef(!1),e=o.useRef(null);function c(){clearTimeout(e.current),u.current=!0,e.current=setTimeout(function(){u.current=!1},50)}var i=o.useRef({top:r,bottom:v});return i.current.top=r,i.current.bottom=v,function(l){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=l<0&&i.current.top||l>0&&i.current.bottom;return t&&n?(clearTimeout(e.current),u.current=!1):(!n||u.current)&&c(),!u.current&&n}};function tt(r,v,u,e){var c=o.useRef(0),i=o.useRef(null),l=o.useRef(null),t=o.useRef(!1),n=Me(v,u);function a(s){if(r){H.cancel(i.current);var d=s.deltaY;c.current+=d,l.current=d,!n(d)&&(et||s.preventDefault(),i.current=H(function(){var g=t.current?10:1;e(c.current*g),c.current=0}))}}function f(s){r&&(t.current=s.detail===l.current)}return[a,f]}var rt=14/15;function nt(r,v,u){var e=o.useRef(!1),c=o.useRef(0),i=o.useRef(null),l=o.useRef(null),t,n=function(d){if(e.current){var g=Math.ceil(d.touches[0].pageY),m=c.current-g;c.current=g,u(m)&&d.preventDefault(),clearInterval(l.current),l.current=setInterval(function(){m*=rt,(!u(m,!0)||Math.abs(m)<=.1)&&clearInterval(l.current)},16)}},a=function(){e.current=!1,t()},f=function(d){t(),d.touches.length===1&&!e.current&&(e.current=!0,c.current=Math.ceil(d.touches[0].pageY),i.current=d.target,i.current.addEventListener("touchmove",n),i.current.addEventListener("touchend",a))};t=function(){i.current&&(i.current.removeEventListener("touchmove",n),i.current.removeEventListener("touchend",a))},ne(function(){return r&&v.current.addEventListener("touchstart",f),function(){var s;(s=v.current)===null||s===void 0||s.removeEventListener("touchstart",f),t(),clearInterval(l.current)}},[r])}var ot=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","component","onScroll","onVisibleChange","innerProps"],at=[],it={overflowY:"auto",overflowAnchor:"none"};function ut(r,v){var u=r.prefixCls,e=u===void 0?"rc-virtual-list":u,c=r.className,i=r.height,l=r.itemHeight,t=r.fullHeight,n=t===void 0?!0:t,a=r.style,f=r.data,s=r.children,d=r.itemKey,g=r.virtual,m=r.component,S=m===void 0?"div":m,M=r.onScroll,D=r.onVisibleChange,L=r.innerProps,U=We(r,ot),b=!!(g!==!1&&i&&l),Y=b&&f&&l*f.length>i,O=o.useState(0),C=_(O,2),E=C[0],J=C[1],I=o.useState(!1),z=_(I,2),k=z[0],w=z[1],W=B(e,c),R=f||at,y=o.useRef(),oe=o.useRef(),ae=o.useRef(),N=o.useCallback(function(h){return typeof d=="function"?d(h):h==null?void 0:h[d]},[d]),be={getKey:N};function K(h){J(function(p){var T;typeof h=="function"?T=h(p):T=h;var P=Le(T);return y.current.scrollTop=P,P})}var ie=o.useRef({start:0,end:R.length}),Ee=o.useRef(),Te=Xe(R,N),ye=_(Te,1),He=ye[0];Ee.current=He;var we=Be(N,null,null),j=_(we,4),xe=j[0],ue=j[1],le=j[2],_e=j[3],V=o.useMemo(function(){if(!b)return{scrollHeight:void 0,start:0,end:R.length-1,offset:void 0};if(!Y){var h;return{scrollHeight:((h=oe.current)===null||h===void 0?void 0:h.offsetHeight)||0,start:0,end:R.length-1,offset:void 0}}for(var p=0,T,P,x,$e=R.length,F=0;F<$e;F+=1){var Ue=R[F],Ye=N(Ue),he=le.get(Ye),re=p+(he===void 0?l:he);re>=E&&T===void 0&&(T=F,P=p),re>E+i&&x===void 0&&(x=F),p=re}return T===void 0&&(T=0,P=0,x=Math.ceil(i/l)),x===void 0&&(x=R.length-1),x=Math.min(x+1,R.length),{scrollHeight:p,start:T,end:x,offset:P}},[Y,b,E,R,_e,i]),Q=V.scrollHeight,A=V.start,G=V.end,De=V.offset;ie.current.start=A,ie.current.end=G;var X=Q-i,ee=o.useRef(X);ee.current=X;function Le(h){var p=h;return Number.isNaN(ee.current)||(p=Math.min(p,ee.current)),p=Math.max(p,0),p}var se=E<=0,ce=E>=X,Ce=Me(se,ce);function Ie(h){var p=h;K(p)}function Pe(h){var p=h.currentTarget.scrollTop;p!==E&&K(p),M==null||M(h)}var ke=tt(b,se,ce,function(h){K(function(p){var T=p+h;return T})}),fe=_(ke,2),te=fe[0],ve=fe[1];nt(b,y,function(h,p){return Ce(h,p)?!1:(te({preventDefault:function(){},deltaY:h}),!0)}),ne(function(){function h(p){b&&p.preventDefault()}return y.current.addEventListener("wheel",te),y.current.addEventListener("DOMMouseScroll",ve),y.current.addEventListener("MozMousePixelScroll",h),function(){y.current&&(y.current.removeEventListener("wheel",te),y.current.removeEventListener("DOMMouseScroll",ve),y.current.removeEventListener("MozMousePixelScroll",h))}},[b]);var Ne=Je(y,R,le,l,N,ue,K,function(){var h;(h=ae.current)===null||h===void 0||h.delayHidden()});o.useImperativeHandle(v,function(){return{scrollTo:Ne}}),ne(function(){if(D){var h=R.slice(A,G+1);D(h,R)}},[A,G,R]);var Fe=Ze(R,A,G,xe,s,be),Z=null;return i&&(Z=$(q({},n?"height":"maxHeight",i),it),b&&(Z.overflowY="hidden",k&&(Z.pointerEvents="none"))),o.createElement("div",ge({style:$($({},a),{},{position:"relative"}),className:W},U),o.createElement(S,{className:"".concat(e,"-holder"),style:Z,ref:y,onScroll:Pe},o.createElement(Se,{prefixCls:e,height:Q,offset:De,onInnerResize:ue,ref:oe,innerProps:L},Fe)),b&&o.createElement(Ae,{ref:ae,prefixCls:e,scrollTop:E,height:i,scrollHeight:Q,count:R.length,onScroll:Ie,onStartMove:function(){w(!0)},onStopMove:function(){w(!1)}}))}var lt=o.forwardRef(ut);lt.displayName="List";export{lt as L};
